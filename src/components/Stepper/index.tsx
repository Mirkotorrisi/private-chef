import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import React, { useRef } from "react";
import "./index.scss";

gsap.registerPlugin(ScrollTrigger);

const steps = [
  {
    numberPath:
      "M17.2888 29.1514V28.0954C17.7848 28.0634 18.1688 27.9594 18.4408 27.7834C18.7288 27.6074 18.9368 27.3434 19.0648 26.9914C19.1928 26.6234 19.2568 26.1514 19.2568 25.5754L19.2088 14.8234L16.4008 16.5754L15.8008 15.6154L20.7448 11.9674H21.7768L21.8008 26.1034C21.8008 26.4394 21.7928 26.7754 21.7768 27.1114C21.7768 27.4314 21.7608 27.7034 21.7288 27.9274C22.0328 27.8954 22.3608 27.8794 22.7128 27.8794C23.0648 27.8634 23.3848 27.8474 23.6728 27.8314V29.1514H17.2888Z",
    title: "Consultazione Iniziale",
    description:
      "Condividi le tue preferenze e desideri. Insieme, progetteremo il tuo evento perfetto.",
  },
  {
    numberPath:
      "M14.6224 29.1514C14.6224 28.3034 14.7424 27.5514 14.9824 26.8954C15.2384 26.2394 15.5744 25.6394 15.9904 25.0954C16.4064 24.5514 16.8784 24.0314 17.4064 23.5354C17.9344 23.0394 18.4704 22.5274 19.0144 21.9994C20.1024 20.9754 20.8784 20.0394 21.3424 19.1914C21.8224 18.3274 22.0624 17.4874 22.0624 16.6714C22.0624 16.0954 21.9824 15.5434 21.8224 15.0154C21.6624 14.4714 21.3824 14.0234 20.9824 13.6714C20.5824 13.3194 20.0304 13.1514 19.3264 13.1674C18.7344 13.1674 18.2064 13.3114 17.7424 13.5994C17.2944 13.8714 16.9824 14.2154 16.8064 14.6314C16.9824 14.7914 17.1024 14.9754 17.1664 15.1834C17.2304 15.3914 17.2624 15.5834 17.2624 15.7594C17.2624 15.9034 17.2144 16.0794 17.1184 16.2874C17.0384 16.4794 16.9024 16.6474 16.7104 16.7914C16.5184 16.9354 16.2624 17.0074 15.9424 17.0074C15.5424 16.9914 15.2304 16.8474 15.0064 16.5754C14.7984 16.2874 14.6944 15.9434 14.6944 15.5434C14.6944 15.2074 14.7984 14.8314 15.0064 14.4154C15.2144 13.9994 15.5344 13.6074 15.9664 13.2394C16.3984 12.8714 16.9264 12.5674 17.5504 12.3274C18.1904 12.0874 18.9344 11.9674 19.7824 11.9674C20.4224 11.9674 21.0464 12.0474 21.6544 12.2074C22.2624 12.3514 22.8144 12.5994 23.3104 12.9514C23.8064 13.2874 24.1984 13.7354 24.4864 14.2954C24.7744 14.8554 24.9184 15.5514 24.9184 16.3834C24.9184 16.7834 24.8384 17.2154 24.6784 17.6794C24.5184 18.1274 24.2464 18.6154 23.8624 19.1434C23.4944 19.6714 22.9984 20.2474 22.3744 20.8714C21.7504 21.4954 20.9664 22.1914 20.0224 22.9594C19.0144 23.7914 18.2064 24.5754 17.5984 25.3114C16.9904 26.0314 16.6384 26.6314 16.5424 27.1114L20.9344 27.2314C21.5904 27.2474 22.1584 27.2394 22.6384 27.2074C23.1344 27.1754 23.5184 27.0474 23.7904 26.8234C24.0784 26.5834 24.2224 26.1754 24.2224 25.5994H25.2064L25.0384 29.1514H14.6224Z",
    title: "Scelta del Menu",
    description:
      "Condividi le tue preferenze e desideri. Insieme, progetteremo il tuo evento perfetto.",
  },
  {
    numberPath:
      "M19.4046 29.5354C18.2366 29.5354 17.2686 29.3594 16.5006 29.0074C15.7486 28.6554 15.1886 28.2234 14.8206 27.7114C14.4686 27.1834 14.2926 26.6714 14.2926 26.1754C14.2926 25.7754 14.4046 25.4314 14.6286 25.1434C14.8526 24.8554 15.1646 24.7034 15.5646 24.6874C15.9006 24.6714 16.1566 24.7354 16.3326 24.8794C16.5246 25.0234 16.6526 25.1914 16.7166 25.3834C16.7966 25.5754 16.8366 25.7594 16.8366 25.9354C16.8366 26.0954 16.8126 26.2634 16.7646 26.4394C16.7166 26.5994 16.6446 26.7674 16.5486 26.9434C16.7086 27.4074 17.0446 27.7514 17.5566 27.9754C18.0686 28.1834 18.6206 28.2874 19.2126 28.2874C20.3006 28.2874 21.1566 27.9754 21.7806 27.3514C22.4046 26.7274 22.7166 25.8714 22.7166 24.7834C22.7166 24.1434 22.6046 23.5194 22.3806 22.9114C22.1726 22.3034 21.7806 21.8074 21.2046 21.4234C20.6286 21.0394 19.7966 20.8634 18.7086 20.8954C18.5806 20.8954 18.4206 20.9034 18.2286 20.9194C18.0366 20.9194 17.8606 20.9274 17.7006 20.9434V19.6474C17.8606 19.6474 18.0126 19.6474 18.1566 19.6474C18.3006 19.6474 18.4446 19.6474 18.5886 19.6474C19.3886 19.6474 20.0286 19.4794 20.5086 19.1434C21.0046 18.8074 21.3646 18.3914 21.5886 17.8954C21.8126 17.3834 21.9246 16.8794 21.9246 16.3834C21.9406 15.7594 21.8606 15.2074 21.6846 14.7274C21.5246 14.2314 21.2526 13.8474 20.8686 13.5754C20.4846 13.2874 19.9566 13.1434 19.2846 13.1434C18.6606 13.1434 18.1166 13.3034 17.6526 13.6234C17.2046 13.9434 16.9166 14.2794 16.7886 14.6314C16.9326 14.8074 17.0286 14.9914 17.0766 15.1834C17.1406 15.3594 17.1726 15.5274 17.1726 15.6874C17.1726 15.8314 17.1246 16.0074 17.0286 16.2154C16.9486 16.4074 16.8126 16.5674 16.6206 16.6954C16.4446 16.8234 16.1966 16.8874 15.8766 16.8874C15.4926 16.8874 15.1966 16.7514 14.9886 16.4794C14.7966 16.2074 14.7006 15.8794 14.7006 15.4954C14.7006 15.0314 14.8766 14.5274 15.2286 13.9834C15.5806 13.4394 16.1246 12.9674 16.8606 12.5674C17.5966 12.1674 18.5246 11.9674 19.6446 11.9674C20.5406 11.9674 21.3646 12.1034 22.1166 12.3754C22.8846 12.6474 23.4926 13.0954 23.9406 13.7194C24.4046 14.3274 24.6366 15.1434 24.6366 16.1674C24.6366 16.6314 24.5166 17.1194 24.2766 17.6314C24.0366 18.1434 23.6366 18.6154 23.0766 19.0474C22.5326 19.4794 21.7806 19.8314 20.8206 20.1034C22.3406 20.2954 23.5086 20.8074 24.3246 21.6394C25.1566 22.4554 25.5726 23.4474 25.5726 24.6154C25.5726 25.7034 25.2926 26.6154 24.7326 27.3514C24.1726 28.0714 23.4206 28.6154 22.4766 28.9834C21.5486 29.3514 20.5246 29.5354 19.4046 29.5354Z",
    title: "Scelta del Menu",
    description:
      "Condividi le tue preferenze e desideri. Insieme, progetteremo il tuo evento perfetto.",
  },
];

const SvgNumber = ({ numberPath }: { numberPath: string }) => (
  <svg
    className="size-10 lg:size-20 xl:size-40"
    width="100%"
    height="100%"
    viewBox="0 0 40 40"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d={numberPath} fill="white" className="opacity-0" />
    <circle
      id="circle"
      cx="20"
      cy="20"
      r="18"
      stroke="#fff"
      fill="none"
      stroke-width="2"
    />
  </svg>
);

const Stepper = () => {
  const container = useRef<HTMLDivElement | null>(null);

  useGSAP(
    () => {
      const steps = gsap.utils.toArray(".step");

      steps.forEach((step: any) => {
        const circle = step.querySelector("circle");
        const line = step.querySelector(".line");
        const number = step.querySelector("path");
        const h4 = step.querySelector("h4");
        const p = step.querySelector("p");
        gsap
          .timeline({
            scrollTrigger: {
              trigger: step,
              start: "center center",
              end: "top bottom",
            },
          })
          .to(circle, {
            strokeDashoffset: 0,
            duration: 1,
          })
          .to(number, {
            opacity: 1,
            duration: 0.25,
          })
          .to(h4, {
            opacity: 1,
            duration: 0.25,
          })
          .to(p, {
            opacity: 1,
            duration: 0.5,
          })
          .to(line, {
            scale: 1,
            translateY: 0,
            duration: 0.5,
          });
      });
    },
    { scope: container }
  );
  return (
    <div className="flex flex-col pt-8 md:pt-0" ref={container}>
      {steps.map((step, index) => (
        <div className="flex flex-1 gap-6 step" key={step.title}>
          <div className="flex flex-col items-center">
            <SvgNumber numberPath={step.numberPath} />

            <div
              className={`w-[2px] lg:w-[4px] h-full scale-0 translate-y-[-100%] ${
                index !== steps.length - 1 ? "bg-white" : ""
              } line`}
            />
          </div>
          <div className="space-y-2 mb-4">
            <h4 className="text-white opacity-0">{step.title}</h4>
            <p className="body-3 text-white opacity-0">{step.description}</p>
          </div>
        </div>
      ))}
    </div>
  );
};

export default Stepper;
